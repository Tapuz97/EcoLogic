<!doctype html>
<html lang="en" class="h-full">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>EcoLogic Admin ¬∑ Analyticsgzuc</title>

  <link id="theme-css" rel="stylesheet" href="/assets/css/style_light.css" />
  <link rel="icon" type="image/svg+xml" href="/assets/logos/EcoIconSVG.svg" />
  <meta name="theme-color" content="#4cd469" />
  <link rel="preload" href="/assets/Fonts/Frankfurter.ttf" as="font" type="font/ttf" crossorigin>
  <script src="https://cdn.jsdelivr.net/npm/chart.js" defer></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-zoom@2" defer></script>
  <script src="../assets/js/AutomataSnails.js" defer></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2" defer></script>
  <script src="https://cdn.jsdelivr.net/npm/jstat@1.9.6/dist/jstat.min.js" defer></script>
  <script src="/assets/js/ThemeToggle.js" defer></script>
  <script src="/assets/js/AdminApp.js" defer></script>
  <script src="/assets/js/StatsCharts.js" defer></script>
  <script>
    // Simple data processor trigger - runs once when page loads
    document.addEventListener('DOMContentLoaded', async () => {
      console.log('üîÑ Processing statistical data...');
      
      try {
        const response = await fetch('/api/data-parser', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ processAll: true })
        });
        
        if (response.ok) {
          const result = await response.json();
          console.log('‚úÖ Statistical data ready:', result.message);
          
          // Trigger charts render after data is processed
          setTimeout(() => {
            if (window.renderAll) window.renderAll();
          }, 500);
        }
      } catch (error) {
        console.error('‚ùå Data processing failed:', error);
      }
    });
  </script>
</head>

<body data-page="analytics" data-icon-base="/assets/icons/" data-logo-base="/assets/logos/">

  <!-- Admin Top Nav (same structure as Reports) -->
  <header class="admin-topnav" aria-label="Admin navigation">
    <div class="admin-topnav-inner">
      <a class="admin-brand" href="/Admin/dashboard.html">
        <img class="nav-icon" data-icon="ecologo" alt="" />
        <span class="brand-name" style="font-size: clamp(23px, 4vw, 23px)" >EcoLogic ¬∑ Admin</span>
      </a>
      <nav class="admin-nav">
        <a href="/Admin/dashboard.html"><img class="nav-icon" data-icon="house" alt="" />Dashboard</a>
        <a href="/Admin/reports.html"><img class="nav-icon" data-icon="doc" alt="" />Reports</a>
        <a href="/Admin/analytics.html" aria-current="page"><img class="nav-icon" data-icon="chart"
            alt="" />Analytics</a>
        <a href="/Admin/export.html"><img class="nav-icon" data-icon="export" alt="" />Export</a>
        <a href="/login.html"><img class="nav-icon" data-icon="logout" alt="" />Logout</a>
      </nav>
      <!-- Theme toggle button -->
      <button id="themeToggle" class="theme-toggle theme-toggle--inline" aria-pressed="false" aria-label="Toggle theme">
        <span class="theme-toggle__icon theme-toggle__moon">üåô</span>
        <span class="theme-toggle__icon theme-toggle__sun">‚òÄÔ∏è</span>
        <div class="theme-toggle__knob"></div>
      </button>
    </div>
  </header>

  <main role="main" class="analytics-main">
    <section class="dashboard-head">
      <h1 class="h1">Analytics</h1>
      <p class="sub">Overview of reports by status, time and species.</p>
    </section>

    <!-- Main Analytics Layout: V-box with Left Panel (Interactive Cards) + Right Panel (Chart Cards) -->
    <div class="analytics-layout">
      <div class="analytics-left">
        <!-- Automata Interactive Card -->
        <div class="interactive-card">
          <div class="interactive-controls">
            <div class="header">
              <h3>Invasive vs Native ¬∑ Live Automata</h3>
              <div class="buttons">
                <button class="btn" id="autoStart" type="button">Start</button>
                <button class="btn btn-ghost" id="autoStep" type="button">Step</button>
                <button class="btn btn-ghost" id="autoReset" type="button">Reset</button>
              </div>
            </div>
            <p class="description">Grid simulation of spread and competition</p>
            
            <div class="params">
              <div class="param-group">
                <label class="label" for="autoSize">Grid</label>
                <input class="input" id="autoSize" type="number" min="20" max="120" value="90">
              </div>

              <div class="param-group">
                <label class="label" for="autoCell">Cell</label>
                <input class="input" id="autoCell" type="number" min="6" max="16" value="10">
              </div>

              <div class="param-group">
                <label class="label" for="alpha">alpha (colonize)</label>
                <input class="input" id="alpha" type="number" step="0.05" min="0" max="1" value="0.35">
              </div>

              <div class="param-group">
                <label class="label" for="beta">beta (invasive pressure)</label>
                <input class="input" id="beta" type="number" step="0.05" min="0" max="1" value="0.45">
              </div>

              <div class="param-group">
                <label class="label" for="gamma">gamma (replace native)</label>
                <input class="input" id="gamma" type="number" step="0.05" min="0" max="1" value="0.40">
              </div>

              <div class="param-group">
                <label class="label" for="delta">delta (native pressure)</label>
                <input class="input" id="delta" type="number" step="0.05" min="0" max="1" value="0.20">
              </div>
            </div>
          </div>
          
          <div class="interactive-canvas">
            <canvas id="automataCanvas"></canvas>
            <div class="canvas-stats" id="autoStats">Gen: 0 ¬∑ Grid: 60¬≤</div>
          </div>
        </div>

        <!-- Kriging Interactive Card -->
        <div class="interactive-card">
          <div class="interactive-controls">
            <div class="header">
              <h3>Kriging map (density_per_m2)</h3>
              <div class="buttons">
                <button class="btn" id="krigRun" type="button">Run</button>
              </div>
            </div>
            
            <div class="params">
              <div class="param-group">
                <label class="label" for="krigField">Field</label>
                <select class="input" id="krigField">
                  <option value="density_per_m2" selected>density_per_m2</option>
                </select>
              </div>
              
              <div class="param-group">
                <label class="label" for="krigSpecies">Species</label>
                <input class="input" id="krigSpecies" type="text" placeholder="Thiara scabra">
              </div>
            </div>
          </div>
          
          <div class="interactive-canvas">
            <canvas id="krigingMap"></canvas>
            <div class="legend" id="krigLegend"></div>
          </div>
        </div>
      </div>

      <!-- RIGHT PANEL: Chart Cards -->
      <div class="analytics-right">
        <div class="chart-card">
          <h3>T-test: Density by Depth</h3>
          <canvas id="chart_ttest_depth"></canvas>
        </div>
        
        <div class="chart-card">
          <h3>ANOVA: Density by Beach</h3>
          <canvas id="chart_anova_beach"></canvas>
        </div>
        
        <div class="chart-card">
          <h3>ANOVA: Density by Habitat</h3>
          <canvas id="chart_anova_habitat"></canvas>
        </div>
        
        <div class="chart-card">
          <h3>Regression: Water level ‚Üí Shannon</h3>
          <canvas id="chart_reg_water"></canvas>
        </div>
        
        <div class="chart-card">
          <h3>Chi-square: Invasive vs Native</h3>
          <canvas id="chart_chi_species"></canvas>
        </div>
      </div>
    </div>

  </main>
</body>

</html>